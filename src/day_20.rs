use petgraph::algo::astar;
use petgraph::prelude::*;
use petgraph::Graph;
use std::cmp;
use std::collections::HashMap;
use std::collections::HashSet;

fn minimum_path(picoseconds: &usize, min_savings: &usize, map: &Vec<Vec<char>>) -> usize {
    let (width, height) = (map[0].len(), map.len());
    let mut g = Graph::new_undirected();

    let (f, a) = create_graph(&map, &mut g);

    let mut cheats: HashMap<usize, usize> = HashMap::new();
    let mut visited: HashSet<(usize, usize)> = HashSet::new();
    let mut start_ends: HashMap<(usize, usize), usize> = HashMap::new();

    if let Some((_cost, apath)) = astar(&g, a, |finish| finish == f, |e| *e.weight(), |_| 0.0) {
        let mut path_xys: Vec<usize> = vec![];
        for i in 0..apath.len() {
            path_xys.push(apath[i].index());
        }

        for p in apath.clone() {
            let idx = p.index();
            if let Some((x, y)) = convert_index_to_xy(&idx, &width, &height) {
                let key = (x, y);
                if !visited.contains(&key) {
                    visited.insert(key);

                    for window in 2..=*picoseconds {
                        explore_window(
                            &window,
                            &p.index(),
                            &key,
                            &mut cheats,
                            &map,
                            &mut start_ends,
                            &path_xys,
                        );
                    }
                }
            }
        }
    }

    cheats
        .iter()
        .filter(|(&k, _v)| k >= *min_savings)
        .map(|(_k, v)| v)
        .sum::<usize>()
}

fn explore_window(
    size: &usize,
    start_idx: &usize,
    end: &(usize, usize),
    cheats: &mut HashMap<usize, usize>,
    map: &Vec<Vec<char>>,
    start_ends: &mut HashMap<(usize, usize), usize>,
    path_xys: &Vec<usize>,
) -> () {
    //how many uniqe points on the path are on this window rotated 45 degrees?
    for i in 0..=*size {
        let j = *size - i;
        let x1 = cmp::max(end.0 as i32 - i as i32, 0) as usize;
        let x2 = cmp::min(end.0 + i, map[0].len() - 1);

        let y1 = cmp::max(end.1 as i32 - j as i32, 0) as usize;
        let y2 = cmp::min(end.1 + j, map.len() - 1);

        let points = vec![(x1, y1), (x1, y2), (x2, y1), (x2, y2)];

        for p in points {
            //can it be an end point?
            if map[p.1][p.0] != '#' {
                let idx = convert_xy_to_index(&p.0, &p.1, &map[0].len());
                let start_pos = path_xys.iter().position(|i| i == start_idx).unwrap();
                let end_pos = path_xys.iter().position(|i| *i == idx).unwrap();

                if end_pos >= start_pos && end_pos - start_pos >= *size {
                    let length = end_pos - start_pos - *size;

                    let savings = length;
                    let prev_savings = start_ends.get(&(*start_idx, idx)).unwrap_or(&0);

                    if savings > *prev_savings {
                        start_ends.insert((*start_idx, idx), savings);
                        cheats.insert(savings, cheats.get(&savings).unwrap_or(&0) + 1);
                    }
                }
            }
        }
    }
}

fn create_graph(
    map: &Vec<Vec<char>>,
    g: &mut Graph<(), f32, Undirected>,
) -> (NodeIndex, NodeIndex) {
    let (width, height) = (map[0].len(), map.len());
    let end_node_graph = g.add_node(());
    let mut graph_nodes: Vec<Vec<NodeIndex>> = vec![];

    for _ in 0..height {
        let mut row: Vec<NodeIndex> = vec![];
        for _ in 0..width {
            row.push(g.add_node(()));
        }
        graph_nodes.push(row.clone());
    }
    for j in 1..height - 1 {
        for i in 1..width - 1 {
            if map[j][i] != '#' {
                let idx = graph_nodes[j][i];

                if map[j - 1][i] != '#' {
                    let idx_top = graph_nodes[j - 1][i];
                    g.add_edge(idx_top, idx, 1.0);
                }

                if map[j][i + 1] != '#' {
                    let idx_right = graph_nodes[j][i + 1];
                    g.add_edge(idx, idx_right, 1.0);
                }

                if map[j + 1][i] != '#' {
                    let idx_bottom = graph_nodes[j + 1][i];
                    g.add_edge(idx, idx_bottom, 1.0);
                }

                if map[j][i - 1] != '#' {
                    let idx_left = graph_nodes[j][i - 1];
                    g.add_edge(idx_left, idx, 1.0);
                }
            }
        }
    }

    let mut start_node_graph = end_node_graph;

    for j in 0..height {
        for i in 0..width {
            if map[j][i] == 'S' {
                start_node_graph = graph_nodes[j][i];
            } else if map[j][i] == 'E' {
                g.add_edge(end_node_graph, graph_nodes[j][i], 0.0);
            }
        }
    }

    (end_node_graph, start_node_graph)
}

fn convert_index_to_xy(index: &usize, width: &usize, height: &usize) -> Option<(usize, usize)> {
    if *index > 0usize {
        let y = (index - 1) / *width;
        let x = index - 1 - y * *width;
        if x > 0 && x < *width && y > 0 && y < *height {
            return Some((x, y));
        }
    }
    None
}

fn convert_xy_to_index(x: &usize, y: &usize, width: &usize) -> usize {
    y * width + x + 1
}

fn _print_map(map: &Vec<Vec<char>>) {
    for l in map {
        for c in l {
            print!("{}", c);
        }
        println!();
    }
}

fn parse_map(source: &str) -> Vec<Vec<char>> {
    source
        .split('\n')
        .map(|line| line.chars().collect())
        .collect()
}

fn main() {
    let source = "###############
#...#...#.....#
#.#.#.#.#.###.#
#S#...#.#.#...#
#######.#.#.###
#######.#.#...#
#######.#.###.#
###..E#...#...#
###.#######.###
#...###...#...#
#.#####.#.###.#
#.#...#.#.#...#
#.#.#.#.#.#.###
#...#...#...###
###############";

    assert_eq!(44, minimum_path(&2, &0, &parse_map(&source)));

    assert_eq!(285, minimum_path(&20, &50, &parse_map(&source)));

    let source ="#############################################################################################################################################
#...............#...#...#.......#...#.........###...#...#.....#...#...........#...###.....###.....#.....#...###.........#...#...#...###.....#
#.#############.#.#.#.#.#.#####.#.#.#.#######.###.#.#.#.#.###.#.#.#.#########.#.#.###.###.###.###.#.###.#.#.###.#######.#.#.#.#.#.#.###.###.#
#.....#.......#.#.#...#.#.....#...#.#...#.....#...#.#.#...#...#.#.#.......#...#.#...#...#.#...#...#.#...#.#.#...#.......#.#.#.#.#.#...#...#.#
#####.#.#####.#.#.#####.#####.#####.###.#.#####.###.#.#####.###.#.#######.#.###.###.###.#.#.###.###.#.###.#.#.###.#######.#.#.#.#.###.###.#.#
#...#...#.....#...#...#.#...#.....#...#.#.....#...#...#.....#...#...###...#...#...#...#.#.#...#...#.#.#...#.#...#.....###.#.#.#...#...#...#.#
#.#.#####.#########.#.#.#.#.#####.###.#.#####.###.#####.#####.#####.###.#####.###.###.#.#.###.###.#.#.#.###.###.#####.###.#.#.#####.###.###.#
#.#.#...#.....#...#.#.#...#.#...#.#...#.....#...#...#...#...#.....#...#.....#...#.#...#.#.###...#.#.#...#...#...#.....#...#.#.#.....###...#.#
#.#.#.#.#####.#.#.#.#.#####.#.#.#.#.#######.###.###.#.###.#.#####.###.#####.###.#.#.###.#.#####.#.#.#####.###.###.#####.###.#.#.#########.#.#
#.#...#.#...#...#...#.....#.#.#.#.#.#...#...#...#...#...#.#.#.....#...###...#...#.#...#.#.#...#.#...#...#.#...#...#...#...#.#.#...#...#...#.#
#.#####.#.#.#############.#.#.#.#.#.#.#.#.###.###.#####.#.#.#.#####.#####.###.###.###.#.#.#.#.#.#####.#.#.#.###.###.#.###.#.#.###.#.#.#.###.#
#...#...#.#.#...#.....#...#...#...#.#.#.#...#...#.#...#...#.#...#...#...#.#...#...#...#.#.#.#.#.....#.#...#...#.###.#...#.#.#.#...#.#...#...#
###.#.###.#.#.#.#.###.#.###########.#.#.###.###.#.#.#.#####.###.#.###.#.#.#.###.###.###.#.#.#.#####.#.#######.#.###.###.#.#.#.#.###.#####.###
#...#.#...#.#.#.#...#.#...........#.#.#.###.#...#.#.#.......#...#...#.#.#.#.#...#...###.#.#.#.#...#.#...#.....#...#...#.#.#...#...#.....#...#
#.###.#.###.#.#.###.#.###########.#.#.#.###.#.###.#.#########.#####.#.#.#.#.#.###.#####.#.#.#.#.#.#.###.#.#######.###.#.#.#######.#####.###.#
#...#.#...#.#.#.#...#.#...........#...#...#.#...#.#.....#...#...#...#.#...#.#...#.###...#.#.#.#.#...#...#.....#...#...#...#.......#...#.#...#
###.#.###.#.#.#.#.###.#.#################.#.###.#.#####.#.#.###.#.###.#####.###.#.###.###.#.#.#.#####.#######.#.###.#######.#######.#.#.#.###
#...#...#.#.#.#.#...#.#...............#...#...#...#.....#.#.#...#...#.....#.....#...#...#.#.#.#...#...#...#...#...#...#.....#...#...#.#.#...#
#.#####.#.#.#.#.###.#.###############.#.#####.#####.#####.#.#.#####.#####.#########.###.#.#.#.###.#.###.#.#.#####.###.#.#####.#.#.###.#.###.#
#.....#...#.#.#.....#.###.............#.......#.....#...#.#.#.....#...###...#.....#.#...#.#.#...#.#.###.#.#.#.....###.#.....#.#.#...#.#.#...#
#####.#####.#.#######.###.#####################.#####.#.#.#.#####.###.#####.#.###.#.#.###.#.###.#.#.###.#.#.#.#######.#####.#.#.###.#.#.#.###
#...#.....#.#...#...#...#.....................#...###.#.#.#.#...#.#...#...#...#...#...#...#...#...#.....#.#.#...###...#...#...#.....#...#...#
#.#.#####.#.###.#.#.###.#####################.###.###.#.#.#.#.#.#.#.###.#.#####.#######.#####.###########.#.###.###.###.#.#################.#
#.#.....#.#.###...#...#...#...###...#...#...#...#.....#.#.#.#.#...#.###.#.#...#...#...#...#...#...........#...#.....#...#.......#.....#...#.#
#.#####.#.#.#########.###.#.#.###.#.#.#.#.#.###.#######.#.#.#.#####.###.#.#.#.###.#.#.###.#.###.#############.#######.#########.#.###.#.#.#.#
#.#...#...#...#...###...#.#.#.#...#.#.#...#...#...#.....#.#.#.....#...#.#...#.#...#.#.....#...#.........#...#.#.......###...###.#...#...#...#
#.#.#.#######.#.#.#####.#.#.#.#.###.#.#######.###.#.#####.#.#####.###.#.#####.#.###.#########.#########.#.#.#.#.#########.#.###.###.#########
#...#.....#...#.#.#.....#...#...#...#.......#.#...#.#...#.#...###.#...#.#.....#...#.#.....#...#.........#.#...#.#.......#.#...#...#.........#
#########.#.###.#.#.#############.#########.#.#.###.#.#.#.###.###.#.###.#.#######.#.#.###.#.###.#########.#####.#.#####.#.###.###.#########.#
#.........#...#.#.#...#.........#...###.....#.#...#.#.#...#...#...#.###.#.....###.#.#.#...#...#.....#...#.....#.#.#.....#.#...###...#.....#.#
#.###########.#.#.###.#.#######.###.###.#####.###.#.#.#####.###.###.###.#####.###.#.#.#.#####.#####.#.#.#####.#.#.#.#####.#.#######.#.###.#.#
#...........#...#.....#.#.....#...#.#...#...#.#...#.#.....#.#...#...#...#.....#...#.#.#...#...#...#.#.#...#...#.#.#.......#...###...#...#.#.#
###########.###########.#.###.###.#.#.###.#.#.#.###.#####.#.#.###.###.###.#####.###.#.###.#.###.#.#.#.###.#.###.#.###########.###.#####.#.#.#
#...#.......#...#...#...#...#.....#.#.#...#...#.#...#...#.#.#...#.###...#.#...#...#.#.#...#...#.#...#.#...#.#...#.#.........#...#.......#...#
#.#.#.#######.#.#.#.#.#####.#######.#.#.#######.#.###.#.#.#.###.#.#####.#.#.#.###.#.#.#.#####.#.#####.#.###.#.###.#.#######.###.#############
#.#.#.......#.#...#...#####...#...#...#.#...#...#...#.#.#.#.#...#.#.....#.#.#.#...#...#...#...#...#...#...#.#.#...#.......#...#.............#
#.#.#######.#.###############.#.#.#####.#.#.#.#####.#.#.#.#.#.###.#.#####.#.#.#.#########.#.#####.#.#####.#.#.#.#########.###.#############.#
#.#.........#.#.........#...#...#...###...#.#.....#.#.#...#.#.#...#.....#.#.#.#.###.......#...#...#...#...#.#...#...#...#...#...........#...#
#.###########.#.#######.#.#.#######.#######.#####.#.#.#####.#.#.#######.#.#.#.#.###.#########.#.#####.#.###.#####.#.#.#.###.###########.#.###
#...#...#...#.#.......#.#.#...#...#.....#...#.....#.#...#...#.#...#...#.#...#.#...#...#...#...#...#...#.....#.....#...#.....#...###...#...###
###.#.#.#.#.#.#######.#.#.###.#.#.#####.#.###.#####.###.#.###.###.#.#.#.#####.###.###.#.#.#.#####.#.#########.###############.#.###.#.#######
###...#...#...#.......#.#...#.#.#.#.....#...#...###...#.#...#...#.#.#.#...#...#...###...#.#...###.#.#...#...#...#...###.......#.....#...#...#
###############.#######.###.#.#.#.#.#######.###.#####.#.###.###.#.#.#.###.#.###.#########.###.###.#.#.#.#.#.###.#.#.###.###############.#.#.#
#...#...###...#.#.....#.....#...#...#...###...#...#...#.#...#...#.#.#.#...#...#.......###.....#...#.#.#...#.....#.#.....#.........#...#...#.#
#.#.#.#.###.#.#.#.###.###############.#.#####.###.#.###.#.###.###.#.#.#.#####.#######.#########.###.#.###########.#######.#######.#.#.#####.#
#.#.#.#.#...#.#.#.###.......#...#...#.#.....#.#...#.#...#...#...#.#.#.#.....#...#...#.#.....###.....#.............#...#...#...###...#.......#
#.#.#.#.#.###.#.#.#########.#.#.#.#.#.#####.#.#.###.#.#####.###.#.#.#.#####.###.#.#.#.#.###.#######################.#.#.###.#.###############
#.#.#.#.#.#...#...#...#...#...#...#...#.....#.#.#...#.#.....#...#.#.#...#...#...#.#.#...#...#...........#...#.......#...#...#...#...###...###
#.#.#.#.#.#.#######.#.#.#.#############.#####.#.#.###.#.#####.###.#.###.#.###.###.#.#####.###.#########.#.#.#.###########.#####.#.#.###.#.###
#.#...#...#...#.....#...#.............#.#...#...#...#.#.#...#...#.#.#...#...#...#.#...#...###.....#...#.#.#.#.............#.....#.#.....#...#
#.###########.#.#####################.#.#.#.#######.#.#.#.#.###.#.#.#.#####.###.#.###.#.#########.#.#.#.#.#.###############.#####.#########.#
#.......#...#...#...#...............#.#...#.....###.#.#...#.#...#...#...#...#...#.#...#...#...#...#.#.#...#...............#.......#.........#
#######.#.#.#####.#.#.#############.#.#########.###.#.#####.#.#########.#.###.###.#.#####.#.#.#.###.#.###################.#########.#########
#.......#.#.#...#.#.#.#.....###.....#.........#.#...#.#.....#.....#.....#...#...#.#...#...#.#...#...#.........#.........#.#...#...#.........#
#.#######.#.#.#.#.#.#.#.###.###.#############.#.#.###.#.#########.#.#######.###.#.###.#.###.#####.###########.#.#######.#.#.#.#.#.#########.#
#.#...#...#.#.#...#...#...#.....#...........#...#.#...#.#...#.....#...#...#...#...#...#...#.......#.........#...#.......#...#.#.#...#...#...#
#.#.#.#.###.#.###########.#######.#########.#####.#.###.#.#.#.#######.#.#.###.#####.#####.#########.#######.#####.###########.#.###.#.#.#.###
#.#.#.#...#...###...#...#.........#...#...#...###...#...#.#.#.......#...#.....#...#.......#...#...#.......#.......#...#...###...###.#.#.#...#
#.#.#.###.#######.#.#.#.###########.#.#.#.###.#######.###.#.#######.###########.#.#########.#.#.#.#######.#########.#.#.#.#########.#.#.###.#
#.#.#.....#.......#.#.#.###.........#...#.....#...###.....#.#.......###.......#.#.#...#.....#...#.#...###.........#.#...#.....#...#...#.....#
#.#.#######.#######.#.#.###.###################.#.#########.#.#########.#####.#.#.#.#.#.#########.#.#.###########.#.#########.#.#.###########
#...#.....#.......#.#.#...#.........#...#.......#.........#.#...#.....#.....#...#...#...#...#...#...#...#.......#...#...#...#...#.......#...#
#####.###.#######.#.#.###.#########.#.#.#.###############.#.###.#.###.#####.#############.#.#.#.#######.#.#####.#####.#.#.#.###########.#.#.#
#...#...#.###...#.#.#...#.#...#...#...#...#.....#.....#...#...#...#...###...#.....#...#...#...#.....#...#.#...#.......#...#.............#.#.#
#.#.###.#.###.#.#.#.###.#.#.#.#.#.#########.###.#.###.#.#####.#####.#####.###.###.#.#.#.###########.#.###.#.#.###########################.#.#
#.#...#.#.....#...#.....#...#.#.#.#.........###...###.#.....#.#...#.....#...#.###...#.#.###.........#.....#.#.###...###...................#.#
#.###.#.#####################.#.#.#.#################.#####.#.#.#.#####.###.#.#######.#.###.###############.#.###.#.###.###################.#
#...#.#.......#.....#...#...#...#...###.............#...#...#...#.....#.#...#.#.......#...#...#.......#.....#.....#...#.#.........#.........#
###.#.#######.#.###.#.#.#.#.###########.###########.###.#.###########.#.#.###.#.#########.###.#.#####.#.#############.#.#.#######.#.#########
#...#...#...#.#.###.#.#...#.............#.......#...###.#.....#...#...#.#.....#...........###...###...#.#...........#...#.......#.#.#...#...#
#.#####.#.#.#.#.###.#.###################.#####.#.#####.#####.#.#.#.###.###########################.###.#.#########.###########.#.#.#.#.#.#.#
#.....#...#...#.#...#...#...............#.#...#...#...#.......#.#.#.....#E............#...#...#...#.....#.#.......#.#...........#...#.#.#.#.#
#####.#########.#.#####.#.#############.#.#.#.#####.#.#########.#.###################.#.#.#.#.#.#.#######.#.#####.#.#.###############.#.#.#.#
#.....#.....#...#.....#.#.............#.#...#.......#.......#...#...#...#############...#...#...#.......#...#...#.#.#.#.......#...#...#...#.#
#.#####.###.#.#######.#.#############.#.###################.#.#####.#.#.###############################.#####.#.#.#.#.#.#####.#.#.#.#######.#
#.#.....###...#...###.#.#.............#...#.............#...#...#...#.#.....###########################.......#.#.#.#...#.....#.#...#...#...#
#.#.###########.#.###.#.#.###############.#.###########.#.#####.#.###.#####.###################################.#.#.#####.#####.#####.#.#.###
#...#...........#...#...#...........#...#.#...........#.#...###.#...#...#...###################################...#.#...#...###.#.....#...###
#####.#############.###############.#.#.#.###########.#.###.###.###.###.#.#########################################.#.#.###.###.#.###########
#.....#...........#.###...#...#...#...#.#.#...........#.....#...#...#...#...#######################################...#.....#...#...........#
#.#####.#########.#.###.#.#.#.#.#.#####.#.#.#################.###.###.#####.#################################################.#############.#
#...#...#.........#.....#...#...#.....#.#.#.###...#.....#...#...#.###.....#.....#####################.....#########.....###...#...#.......#.#
###.#.###.###########################.#.#.#.###.#.#.###.#.#.###.#.#######.#####.#####################.###.#########.###.###.###.#.#.#####.#.#
###...###...#...#.....#...#.........#...#...#...#...#...#.#.#...#.....#...#.....#####....S#.....#...#...#.....#####...#...#...#.#...#...#...#
###########.#.#.#.###.#.#.#.#######.#########.#######.###.#.#.#######.#.###.#########.#####.###.#.#.###.#####.#######.###.###.#.#####.#.#####
#.......###.#.#.#.###...#...#...###.........#.#.......#...#.#.....#...#...#.#...#####.....#.###...#.....#.....###...#...#...#.#.....#.#.....#
#.#####.###.#.#.#.###########.#.###########.#.#.#######.###.#####.#.#####.#.#.#.#########.#.#############.#######.#.###.###.#.#####.#.#####.#
#.#...#.....#.#.#.#...........#.......#...#...#...#...#...#.#...#.#.#...#.#...#.#####.....#.#...#.....#...#.....#.#.#...#...#.#.....#.#.....#
#.#.#.#######.#.#.#.#################.#.#.#######.#.#.###.#.#.#.#.#.#.#.#.#####.#####.#####.#.#.#.###.#.###.###.#.#.#.###.###.#.#####.#.#####
#.#.#.....#...#...#.........#.......#...#.........#.#.....#.#.#...#.#.#.#.#.....#####...#...#.#.#...#.#.....#...#.#.#...#.....#.......#.#...#
#.#.#####.#.###############.#.#####.###############.#######.#.#####.#.#.#.#.###########.#.###.#.###.#.#######.###.#.###.###############.#.#.#
#...#.....#.#.....#...#.....#.#.....#.........###...#.....#.#.#...#.#.#.#.#.....###...#...#...#.....#.........#...#.....#...#...#.....#...#.#
#####.#####.#.###.#.#.#.#####.#.#####.#######.###.###.###.#.#.#.#.#.#.#.#.#####.###.#.#####.###################.#########.#.#.#.#.###.#####.#
#.....#...#.#...#...#...#.....#.......#.......#...#...###...#...#.#.#.#.#.#...#.#...#.....#.#...#.....#...#.....#...#.....#...#...###.......#
#.#####.#.#.###.#########.#############.#######.###.#############.#.#.#.#.#.#.#.#.#######.#.#.#.#.###.#.#.#.#####.#.#.#######################
#...#...#...###...........#...........#.....###...#.....#...###...#.#.#.#.#.#...#.......#.#...#...###...#...#.....#...#...#.........#.......#
###.#.#####################.#########.#####.#####.#####.#.#.###.###.#.#.#.#.###########.#.###################.#########.#.#.#######.#.#####.#
#...#.#.....#...#...........#.......#.....#.#.....#.....#.#.#...#...#.#.#.#...#...#.....#.###.........#.......#.........#...#.......#.#.....#
#.###.#.###.#.#.#.###########.#####.#####.#.#.#####.#####.#.#.###.###.#.#.###.#.#.#.#####.###.#######.#.#######.#############.#######.#.#####
#...#.#...#...#...#...........#.....#...#...#.....#.#...#.#.#.#...#...#.#.#...#.#.#.....#...#.......#.#.........#.....#.......###...#.#.#...#
###.#.###.#########.###########.#####.#.#########.#.#.#.#.#.#.#.###.###.#.#.###.#.#####.###.#######.#.###########.###.#.#########.#.#.#.#.#.#
#...#.#...#...#...#.#.........#.....#.#...#...#...#...#.#.#.#.#.###...#.#.#.#...#.#...#...#...#...#.#.#...........###...#.........#...#...#.#
#.###.#.###.#.#.#.#.#.#######.#####.#.###.#.#.#.#######.#.#.#.#.#####.#.#.#.#.###.#.#.###.###.#.#.#.#.#.#################.#################.#
#.....#.....#...#...#.......#.#...#.#.#...#.#.#.......#.#.#.#.#.#...#.#.#.#.#...#.#.#.###.#...#.#.#.#.#.........#...#.....#.................#
###########################.#.#.#.#.#.#.###.#.#######.#.#.#.#.#.#.#.#.#.#.#.###.#.#.#.###.#.###.#.#.#.#########.#.#.#.#####.#################
#...................#.......#...#...#.#...#.#.#...#...#...#...#.#.#...#.#.#.#...#.#.#.#...#...#.#.#.#.....#...#...#...#...#.............#...#
#.#################.#.###############.###.#.#.#.#.#.###########.#.#####.#.#.#.###.#.#.#.#####.#.#.#.#####.#.#.#########.#.#############.#.#.#
#.................#.#.............#...#...#.#.#.#.#.......#.....#.....#.#.#.#.#...#.#...###...#.#.#.....#.#.#.#.....#...#.#.......#.....#.#.#
#################.#.#############.#.###.###.#.#.#.#######.#.#########.#.#.#.#.#.###.#######.###.#.#####.#.#.#.#.###.#.###.#.#####.#.#####.#.#
#.........#...#...#...............#...#.#...#.#.#...#...#.#...#...#...#.#.#.#.#...#.......#.....#.#.....#.#.#.#...#.#...#...#...#...###...#.#
#.#######.#.#.#.#####################.#.#.###.#.###.#.#.#.###.#.#.#.###.#.#.#.###.#######.#######.#.#####.#.#.###.#.###.#####.#.#######.###.#
#.......#...#.#...........#.....#...#.#.#.#...#...#...#.#.#...#.#.#.#...#.#.#...#.#...#...#.......#.....#.#.#.#...#...#.......#.......#...#.#
#######.#####.###########.#.###.#.#.#.#.#.#.#####.#####.#.#.###.#.#.#.###.#.###.#.#.#.#.###.###########.#.#.#.#.#####.###############.###.#.#
#.......#...#.............#.###.#.#.#.#.#.#.#...#...#...#.#.#...#.#.#.....#...#.#...#.#...#.#.....#...#.#.#.#.#.....#.#.....#.........#...#.#
#.#######.#.###############.###.#.#.#.#.#.#.#.#.###.#.###.#.#.###.#.#########.#.#####.###.#.#.###.#.#.#.#.#.#.#####.#.#.###.#.#########.###.#
#.....#...#.................#...#.#.#.#.#.#.#.#.#...#...#.#.#.#...#.......###.#.#.....#...#.#...#.#.#...#.#.#.#.....#.#.#...#.........#...#.#
#####.#.#####################.###.#.#.#.#.#.#.#.#.#####.#.#.#.#.#########.###.#.#.#####.###.###.#.#.#####.#.#.#.#####.#.#.###########.###.#.#
#...#...#.....................#...#.#.#.#.#.#.#.#.....#...#...#.....#...#...#.#.#.....#...#...#.#.#.###...#.#.#...#...#.#.#...........#...#.#
#.#.#####.#####################.###.#.#.#.#.#.#.#####.#############.#.#.###.#.#.#####.###.###.#.#.#.###.###.#.###.#.###.#.#.###########.###.#
#.#...###.....#.....#...#...#...#...#.#.#.#.#.#.....#.#...#...#...#.#.#.....#...#.....#...#...#.#.#...#...#.#.....#.#...#.#.........#...#...#
#.###.#######.#.###.#.#.#.#.#.###.###.#.#.#.#.#####.#.#.#.#.#.#.#.#.#.###########.#####.###.###.#.###.###.#.#######.#.###.#########.#.###.###
#...#.........#...#...#.#.#.#...#.#...#.#.#.#...###.#...#.#.#...#...#...#...#...#...#...#...#...#.#...#...#.......#...#...#...#...#...#...###
###.#############.#####.#.#.###.#.#.###.#.#.###.###.#####.#.###########.#.#.#.#.###.#.###.###.###.#.###.#########.#####.###.#.#.#.#####.#####
#...#.....#.....#.#.....#.#...#.#...###.#.#.#...#...#...#.#.#.....#...#...#...#.#...#...#...#.#...#...#.#...#...#.#.....#...#.#.#.#...#.....#
#.###.###.#.###.#.#.#####.###.#.#######.#.#.#.###.###.#.#.#.#.###.#.#.#########.#.#####.###.#.#.#####.#.#.#.#.#.#.#.#####.###.#.#.#.#.#####.#
#.#...#...#.###...#.....#.###.#...#.....#.#...###...#.#...#.#.#...#.#...#.....#.#.#.....###.#.#.#...#.#.#.#.#.#.#.#.#...#...#...#.#.#.......#
#.#.###.###.###########.#.###.###.#.#####.#########.#.#####.#.#.###.###.#.###.#.#.#.#######.#.#.#.#.#.#.#.#.#.#.#.#.#.#.###.#####.#.#########
#.#...#...#.#...........#.#...#...#...#...###.......#.#...#...#...#...#.#.#...#.#.#...#...#...#.#.#.#.#.#.#...#...#...#.#...###...#...###...#
#.###.###.#.#.###########.#.###.#####.#.#####.#######.#.#.#######.###.#.#.#.###.#.###.#.#.#####.#.#.#.#.#.#############.#.#####.#####.###.#.#
#.#...###...#...........#.#...#.###...#.....#...#...#...#...#...#.#...#.#.#.#...#...#...#.#.....#.#.#.#.#.........#.....#...#...#...#.....#.#
#.#.###################.#.###.#.###.#######.###.#.#.#######.#.#.#.#.###.#.#.#.#####.#####.#.#####.#.#.#.#########.#.#######.#.###.#.#######.#
#.#.#.....#.............#.#...#...#.#...#...###...#...#...#...#.#.#.#...#.#.#.#...#.#.....#.#...#.#.#.#.#.....#...#.....#...#.#...#.#.....#.#
#.#.#.###.#.#############.#.#####.#.#.#.#.###########.#.#.#####.#.#.#.###.#.#.#.#.#.#.#####.#.#.#.#.#.#.#.###.#.#######.#.###.#.###.#.###.#.#
#.#.#...#...#...........#.#...#...#.#.#.#.###.........#.#.#...#.#...#...#.#.#.#.#...#.....#.#.#...#.#.#.#...#.#.#...#...#...#.#.###.#...#.#.#
#.#.###.#####.#########.#.###.#.###.#.#.#.###.#########.#.#.#.#.#######.#.#.#.#.#########.#.#.#####.#.#.###.#.#.#.#.#.#####.#.#.###.###.#.#.#
#...###.......#...#.....#...#.#...#.#.#.#...#.......#...#.#.#.#.....###...#.#.#.......#...#.#...###...#.#...#...#.#...#.....#...#...#...#.#.#
###############.#.#.#######.#.###.#.#.#.###.#######.#.###.#.#.#####.#######.#.#######.#.###.###.#######.#.#######.#####.#########.###.###.#.#
#...............#...#.....#.#...#.#.#.#.#...#.......#.#...#.#.#...#.......#.#.#.......#...#.#...#.......#.......#...#...#.........#...#...#.#
#.###################.###.#.###.#.#.#.#.#.###.#######.#.###.#.#.#.#######.#.#.#.#########.#.#.###.#############.###.#.###.#########.###.###.#
#.....................###...###...#...#...###.........#.....#...#.........#...#...........#...###...............###...###...........###.....#
#############################################################################################################################################";

    assert_eq!(1384, minimum_path(&2, &100, &parse_map(&source)));
    assert_eq!(1008542, minimum_path(&20, &100, &parse_map(&source)));
}
