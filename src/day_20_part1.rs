use petgraph::algo::astar;
use petgraph::prelude::*;
use petgraph::Graph;
use std::collections::HashMap;
use std::collections::HashSet;

const DIRECTIONS: [(i32, i32); 4] = [(-1, 0), (1, 0), (0, -1), (0, 1)];

fn minimum_path(score: &usize, map: &Vec<Vec<char>>) -> usize {
    let (width, height) = (map[0].len(), map.len());
    let mut g = Graph::new_undirected();

    let (f, a) = create_graph(&map, &mut g);

    //remove one wall at a time on the path... calculate a*
    let mut cheats: HashMap<usize, usize> = HashMap::new();
    let mut visited: HashSet<Vec<NodeIndex>> = HashSet::new();
    let mut removed_walls: HashSet<(usize, usize)> = HashSet::new();

    if let Some((cost, apath)) = astar(&g, a, |finish| finish == f, |e| *e.weight(), |_| 0.0) {
        for p in apath.clone() {
            let idx = p.index();
            if let Some((x0, y0)) = convert_index_to_xy(&idx, &width, &height) {
                for dxdy in DIRECTIONS {
                    let (x, y) = (
                        ((x0 as i32) + dxdy.0) as usize,
                        ((y0 as i32) + dxdy.1) as usize,
                    );
                    if !removed_walls.contains(&(x, y)) && map[y][x] == '#' {
                        //remove the wall
                        let mut new_map = map.clone();
                        new_map[y][x] = '.';

                        update_cheats(&(cost as usize), &mut cheats, &mut visited, &new_map);
                        removed_walls.insert((x, y));
                    }
                }
            }
        }
    }

    //println!("Cheats:{:?}\n CutOff: {:?}\n\n Removed: {:?}", cheats, score, removed_walls);
    cheats
        .iter()
        .filter(|(&k, _v)| k >= *score)
        .map(|(_k, v)| v)
        .sum::<usize>()
}

fn update_cheats(
    final_cost: &usize,
    cheats: &mut HashMap<usize, usize>,
    visited: &mut HashSet<Vec<NodeIndex>>,
    map: &Vec<Vec<char>>,
) -> () {
    let mut g2 = Graph::new_undirected();
    let (f2, a2) = create_graph(&map, &mut g2);
    if let Some((cost, apath)) = astar(&g2, a2, |finish| finish == f2, |e| *e.weight(), |_| 0.0) {
        if !visited.contains(&apath) {
            let ucost = cost as usize;
            if ucost < *final_cost {
                let savings = *final_cost - ucost;
                cheats.insert(savings, cheats.get(&savings).unwrap_or(&0) + 1);
            }
            visited.insert(apath);
        }
    }
}

fn create_graph(
    map: &Vec<Vec<char>>,
    g: &mut Graph<(), f32, Undirected>,
) -> (NodeIndex, NodeIndex) {
    let (width, height) = (map[0].len(), map.len());
    let end_node_graph = g.add_node(());
    let mut graph_nodes: Vec<Vec<NodeIndex>> = vec![];

    for _ in 0..height {
        let mut row: Vec<NodeIndex> = vec![];
        for _ in 0..width {
            let idx = g.add_node(());
            row.push(idx);
        }
        graph_nodes.push(row.clone());
    }
    for j in 1..height - 1 {
        for i in 1..width - 1 {
            if map[j][i] != '#' {
                let idx = graph_nodes[j][i];

                if map[j - 1][i] != '#' {
                    let idx_top = graph_nodes[j - 1][i];
                    g.add_edge(idx_top, idx, 1.0);
                }

                if map[j][i + 1] != '#' {
                    let idx_right = graph_nodes[j][i + 1];
                    g.add_edge(idx, idx_right, 1.0);
                }

                if map[j + 1][i] != '#' {
                    let idx_bottom = graph_nodes[j + 1][i];
                    g.add_edge(idx, idx_bottom, 1.0);
                }

                if map[j][i - 1] != '#' {
                    let idx_left = graph_nodes[j][i - 1];
                    g.add_edge(idx_left, idx, 1.0);
                }
            }
        }
    }

    let start_node_graph = g.add_node(());

    for j in 0..height {
        for i in 0..width {
            if map[j][i] == 'S' {
                g.add_edge(start_node_graph, graph_nodes[j][i], 0.0);
            } else if map[j][i] == 'E' {
                g.add_edge(end_node_graph, graph_nodes[j][i], 0.0);
            }
        }
    }

    (end_node_graph, start_node_graph)
}

fn convert_index_to_xy(index: &usize, width: &usize, height: &usize) -> Option<(usize, usize)> {
    if *index > 0usize {
        let y = (index - 1) / *width;
        let x = index - 1 - y * *width;
        if x > 0 && x < *width && y > 0 && y < *height {
            return Some((x, y));
        }
    }
    None
}

fn _print_map(map: &Vec<Vec<char>>) {
    for l in map {
        for c in l {
            print!("{}", c);
        }
        println!();
    }
}

fn parse_map(source: &str) -> Vec<Vec<char>> {
    source
        .split('\n')
        .map(|line| line.chars().collect())
        .collect()
}

fn main() {
    let source = "###############
#...#...#.....#
#.#.#.#.#.###.#
#S#...#.#.#...#
#######.#.#.###
#######.#.#...#
#######.#.###.#
###..E#...#...#
###.#######.###
#...###...#...#
#.#####.#.###.#
#.#...#.#.#...#
#.#.#.#.#.#.###
#...#...#...###
###############";

    assert_eq!(44, minimum_path(&0, &parse_map(&source)));

    let source ="#############################################################################################################################################
#...............#...#...#.......#...#.........###...#...#.....#...#...........#...###.....###.....#.....#...###.........#...#...#...###.....#
#.#############.#.#.#.#.#.#####.#.#.#.#######.###.#.#.#.#.###.#.#.#.#########.#.#.###.###.###.###.#.###.#.#.###.#######.#.#.#.#.#.#.###.###.#
#.....#.......#.#.#...#.#.....#...#.#...#.....#...#.#.#...#...#.#.#.......#...#.#...#...#.#...#...#.#...#.#.#...#.......#.#.#.#.#.#...#...#.#
#####.#.#####.#.#.#####.#####.#####.###.#.#####.###.#.#####.###.#.#######.#.###.###.###.#.#.###.###.#.###.#.#.###.#######.#.#.#.#.###.###.#.#
#...#...#.....#...#...#.#...#.....#...#.#.....#...#...#.....#...#...###...#...#...#...#.#.#...#...#.#.#...#.#...#.....###.#.#.#...#...#...#.#
#.#.#####.#########.#.#.#.#.#####.###.#.#####.###.#####.#####.#####.###.#####.###.###.#.#.###.###.#.#.#.###.###.#####.###.#.#.#####.###.###.#
#.#.#...#.....#...#.#.#...#.#...#.#...#.....#...#...#...#...#.....#...#.....#...#.#...#.#.###...#.#.#...#...#...#.....#...#.#.#.....###...#.#
#.#.#.#.#####.#.#.#.#.#####.#.#.#.#.#######.###.###.#.###.#.#####.###.#####.###.#.#.###.#.#####.#.#.#####.###.###.#####.###.#.#.#########.#.#
#.#...#.#...#...#...#.....#.#.#.#.#.#...#...#...#...#...#.#.#.....#...###...#...#.#...#.#.#...#.#...#...#.#...#...#...#...#.#.#...#...#...#.#
#.#####.#.#.#############.#.#.#.#.#.#.#.#.###.###.#####.#.#.#.#####.#####.###.###.###.#.#.#.#.#.#####.#.#.#.###.###.#.###.#.#.###.#.#.#.###.#
#...#...#.#.#...#.....#...#...#...#.#.#.#...#...#.#...#...#.#...#...#...#.#...#...#...#.#.#.#.#.....#.#...#...#.###.#...#.#.#.#...#.#...#...#
###.#.###.#.#.#.#.###.#.###########.#.#.###.###.#.#.#.#####.###.#.###.#.#.#.###.###.###.#.#.#.#####.#.#######.#.###.###.#.#.#.#.###.#####.###
#...#.#...#.#.#.#...#.#...........#.#.#.###.#...#.#.#.......#...#...#.#.#.#.#...#...###.#.#.#.#...#.#...#.....#...#...#.#.#...#...#.....#...#
#.###.#.###.#.#.###.#.###########.#.#.#.###.#.###.#.#########.#####.#.#.#.#.#.###.#####.#.#.#.#.#.#.###.#.#######.###.#.#.#######.#####.###.#
#...#.#...#.#.#.#...#.#...........#...#...#.#...#.#.....#...#...#...#.#...#.#...#.###...#.#.#.#.#...#...#.....#...#...#...#.......#...#.#...#
###.#.###.#.#.#.#.###.#.#################.#.###.#.#####.#.#.###.#.###.#####.###.#.###.###.#.#.#.#####.#######.#.###.#######.#######.#.#.#.###
#...#...#.#.#.#.#...#.#...............#...#...#...#.....#.#.#...#...#.....#.....#...#...#.#.#.#...#...#...#...#...#...#.....#...#...#.#.#...#
#.#####.#.#.#.#.###.#.###############.#.#####.#####.#####.#.#.#####.#####.#########.###.#.#.#.###.#.###.#.#.#####.###.#.#####.#.#.###.#.###.#
#.....#...#.#.#.....#.###.............#.......#.....#...#.#.#.....#...###...#.....#.#...#.#.#...#.#.###.#.#.#.....###.#.....#.#.#...#.#.#...#
#####.#####.#.#######.###.#####################.#####.#.#.#.#####.###.#####.#.###.#.#.###.#.###.#.#.###.#.#.#.#######.#####.#.#.###.#.#.#.###
#...#.....#.#...#...#...#.....................#...###.#.#.#.#...#.#...#...#...#...#...#...#...#...#.....#.#.#...###...#...#...#.....#...#...#
#.#.#####.#.###.#.#.###.#####################.###.###.#.#.#.#.#.#.#.###.#.#####.#######.#####.###########.#.###.###.###.#.#################.#
#.#.....#.#.###...#...#...#...###...#...#...#...#.....#.#.#.#.#...#.###.#.#...#...#...#...#...#...........#...#.....#...#.......#.....#...#.#
#.#####.#.#.#########.###.#.#.###.#.#.#.#.#.###.#######.#.#.#.#####.###.#.#.#.###.#.#.###.#.###.#############.#######.#########.#.###.#.#.#.#
#.#...#...#...#...###...#.#.#.#...#.#.#...#...#...#.....#.#.#.....#...#.#...#.#...#.#.....#...#.........#...#.#.......###...###.#...#...#...#
#.#.#.#######.#.#.#####.#.#.#.#.###.#.#######.###.#.#####.#.#####.###.#.#####.#.###.#########.#########.#.#.#.#.#########.#.###.###.#########
#...#.....#...#.#.#.....#...#...#...#.......#.#...#.#...#.#...###.#...#.#.....#...#.#.....#...#.........#.#...#.#.......#.#...#...#.........#
#########.#.###.#.#.#############.#########.#.#.###.#.#.#.###.###.#.###.#.#######.#.#.###.#.###.#########.#####.#.#####.#.###.###.#########.#
#.........#...#.#.#...#.........#...###.....#.#...#.#.#...#...#...#.###.#.....###.#.#.#...#...#.....#...#.....#.#.#.....#.#...###...#.....#.#
#.###########.#.#.###.#.#######.###.###.#####.###.#.#.#####.###.###.###.#####.###.#.#.#.#####.#####.#.#.#####.#.#.#.#####.#.#######.#.###.#.#
#...........#...#.....#.#.....#...#.#...#...#.#...#.#.....#.#...#...#...#.....#...#.#.#...#...#...#.#.#...#...#.#.#.......#...###...#...#.#.#
###########.###########.#.###.###.#.#.###.#.#.#.###.#####.#.#.###.###.###.#####.###.#.###.#.###.#.#.#.###.#.###.#.###########.###.#####.#.#.#
#...#.......#...#...#...#...#.....#.#.#...#...#.#...#...#.#.#...#.###...#.#...#...#.#.#...#...#.#...#.#...#.#...#.#.........#...#.......#...#
#.#.#.#######.#.#.#.#.#####.#######.#.#.#######.#.###.#.#.#.###.#.#####.#.#.#.###.#.#.#.#####.#.#####.#.###.#.###.#.#######.###.#############
#.#.#.......#.#...#...#####...#...#...#.#...#...#...#.#.#.#.#...#.#.....#.#.#.#...#...#...#...#...#...#...#.#.#...#.......#...#.............#
#.#.#######.#.###############.#.#.#####.#.#.#.#####.#.#.#.#.#.###.#.#####.#.#.#.#########.#.#####.#.#####.#.#.#.#########.###.#############.#
#.#.........#.#.........#...#...#...###...#.#.....#.#.#...#.#.#...#.....#.#.#.#.###.......#...#...#...#...#.#...#...#...#...#...........#...#
#.###########.#.#######.#.#.#######.#######.#####.#.#.#####.#.#.#######.#.#.#.#.###.#########.#.#####.#.###.#####.#.#.#.###.###########.#.###
#...#...#...#.#.......#.#.#...#...#.....#...#.....#.#...#...#.#...#...#.#...#.#...#...#...#...#...#...#.....#.....#...#.....#...###...#...###
###.#.#.#.#.#.#######.#.#.###.#.#.#####.#.###.#####.###.#.###.###.#.#.#.#####.###.###.#.#.#.#####.#.#########.###############.#.###.#.#######
###...#...#...#.......#.#...#.#.#.#.....#...#...###...#.#...#...#.#.#.#...#...#...###...#.#...###.#.#...#...#...#...###.......#.....#...#...#
###############.#######.###.#.#.#.#.#######.###.#####.#.###.###.#.#.#.###.#.###.#########.###.###.#.#.#.#.#.###.#.#.###.###############.#.#.#
#...#...###...#.#.....#.....#...#...#...###...#...#...#.#...#...#.#.#.#...#...#.......###.....#...#.#.#...#.....#.#.....#.........#...#...#.#
#.#.#.#.###.#.#.#.###.###############.#.#####.###.#.###.#.###.###.#.#.#.#####.#######.#########.###.#.###########.#######.#######.#.#.#####.#
#.#.#.#.#...#.#.#.###.......#...#...#.#.....#.#...#.#...#...#...#.#.#.#.....#...#...#.#.....###.....#.............#...#...#...###...#.......#
#.#.#.#.#.###.#.#.#########.#.#.#.#.#.#####.#.#.###.#.#####.###.#.#.#.#####.###.#.#.#.#.###.#######################.#.#.###.#.###############
#.#.#.#.#.#...#...#...#...#...#...#...#.....#.#.#...#.#.....#...#.#.#...#...#...#.#.#...#...#...........#...#.......#...#...#...#...###...###
#.#.#.#.#.#.#######.#.#.#.#############.#####.#.#.###.#.#####.###.#.###.#.###.###.#.#####.###.#########.#.#.#.###########.#####.#.#.###.#.###
#.#...#...#...#.....#...#.............#.#...#...#...#.#.#...#...#.#.#...#...#...#.#...#...###.....#...#.#.#.#.............#.....#.#.....#...#
#.###########.#.#####################.#.#.#.#######.#.#.#.#.###.#.#.#.#####.###.#.###.#.#########.#.#.#.#.#.###############.#####.#########.#
#.......#...#...#...#...............#.#...#.....###.#.#...#.#...#...#...#...#...#.#...#...#...#...#.#.#...#...............#.......#.........#
#######.#.#.#####.#.#.#############.#.#########.###.#.#####.#.#########.#.###.###.#.#####.#.#.#.###.#.###################.#########.#########
#.......#.#.#...#.#.#.#.....###.....#.........#.#...#.#.....#.....#.....#...#...#.#...#...#.#...#...#.........#.........#.#...#...#.........#
#.#######.#.#.#.#.#.#.#.###.###.#############.#.#.###.#.#########.#.#######.###.#.###.#.###.#####.###########.#.#######.#.#.#.#.#.#########.#
#.#...#...#.#.#...#...#...#.....#...........#...#.#...#.#...#.....#...#...#...#...#...#...#.......#.........#...#.......#...#.#.#...#...#...#
#.#.#.#.###.#.###########.#######.#########.#####.#.###.#.#.#.#######.#.#.###.#####.#####.#########.#######.#####.###########.#.###.#.#.#.###
#.#.#.#...#...###...#...#.........#...#...#...###...#...#.#.#.......#...#.....#...#.......#...#...#.......#.......#...#...###...###.#.#.#...#
#.#.#.###.#######.#.#.#.###########.#.#.#.###.#######.###.#.#######.###########.#.#########.#.#.#.#######.#########.#.#.#.#########.#.#.###.#
#.#.#.....#.......#.#.#.###.........#...#.....#...###.....#.#.......###.......#.#.#...#.....#...#.#...###.........#.#...#.....#...#...#.....#
#.#.#######.#######.#.#.###.###################.#.#########.#.#########.#####.#.#.#.#.#.#########.#.#.###########.#.#########.#.#.###########
#...#.....#.......#.#.#...#.........#...#.......#.........#.#...#.....#.....#...#...#...#...#...#...#...#.......#...#...#...#...#.......#...#
#####.###.#######.#.#.###.#########.#.#.#.###############.#.###.#.###.#####.#############.#.#.#.#######.#.#####.#####.#.#.#.###########.#.#.#
#...#...#.###...#.#.#...#.#...#...#...#...#.....#.....#...#...#...#...###...#.....#...#...#...#.....#...#.#...#.......#...#.............#.#.#
#.#.###.#.###.#.#.#.###.#.#.#.#.#.#########.###.#.###.#.#####.#####.#####.###.###.#.#.#.###########.#.###.#.#.###########################.#.#
#.#...#.#.....#...#.....#...#.#.#.#.........###...###.#.....#.#...#.....#...#.###...#.#.###.........#.....#.#.###...###...................#.#
#.###.#.#####################.#.#.#.#################.#####.#.#.#.#####.###.#.#######.#.###.###############.#.###.#.###.###################.#
#...#.#.......#.....#...#...#...#...###.............#...#...#...#.....#.#...#.#.......#...#...#.......#.....#.....#...#.#.........#.........#
###.#.#######.#.###.#.#.#.#.###########.###########.###.#.###########.#.#.###.#.#########.###.#.#####.#.#############.#.#.#######.#.#########
#...#...#...#.#.###.#.#...#.............#.......#...###.#.....#...#...#.#.....#...........###...###...#.#...........#...#.......#.#.#...#...#
#.#####.#.#.#.#.###.#.###################.#####.#.#####.#####.#.#.#.###.###########################.###.#.#########.###########.#.#.#.#.#.#.#
#.....#...#...#.#...#...#...............#.#...#...#...#.......#.#.#.....#E............#...#...#...#.....#.#.......#.#...........#...#.#.#.#.#
#####.#########.#.#####.#.#############.#.#.#.#####.#.#########.#.###################.#.#.#.#.#.#.#######.#.#####.#.#.###############.#.#.#.#
#.....#.....#...#.....#.#.............#.#...#.......#.......#...#...#...#############...#...#...#.......#...#...#.#.#.#.......#...#...#...#.#
#.#####.###.#.#######.#.#############.#.###################.#.#####.#.#.###############################.#####.#.#.#.#.#.#####.#.#.#.#######.#
#.#.....###...#...###.#.#.............#...#.............#...#...#...#.#.....###########################.......#.#.#.#...#.....#.#...#...#...#
#.#.###########.#.###.#.#.###############.#.###########.#.#####.#.###.#####.###################################.#.#.#####.#####.#####.#.#.###
#...#...........#...#...#...........#...#.#...........#.#...###.#...#...#...###################################...#.#...#...###.#.....#...###
#####.#############.###############.#.#.#.###########.#.###.###.###.###.#.#########################################.#.#.###.###.#.###########
#.....#...........#.###...#...#...#...#.#.#...........#.....#...#...#...#...#######################################...#.....#...#...........#
#.#####.#########.#.###.#.#.#.#.#.#####.#.#.#################.###.###.#####.#################################################.#############.#
#...#...#.........#.....#...#...#.....#.#.#.###...#.....#...#...#.###.....#.....#####################.....#########.....###...#...#.......#.#
###.#.###.###########################.#.#.#.###.#.#.###.#.#.###.#.#######.#####.#####################.###.#########.###.###.###.#.#.#####.#.#
###...###...#...#.....#...#.........#...#...#...#...#...#.#.#...#.....#...#.....#####....S#.....#...#...#.....#####...#...#...#.#...#...#...#
###########.#.#.#.###.#.#.#.#######.#########.#######.###.#.#.#######.#.###.#########.#####.###.#.#.###.#####.#######.###.###.#.#####.#.#####
#.......###.#.#.#.###...#...#...###.........#.#.......#...#.#.....#...#...#.#...#####.....#.###...#.....#.....###...#...#...#.#.....#.#.....#
#.#####.###.#.#.#.###########.#.###########.#.#.#######.###.#####.#.#####.#.#.#.#########.#.#############.#######.#.###.###.#.#####.#.#####.#
#.#...#.....#.#.#.#...........#.......#...#...#...#...#...#.#...#.#.#...#.#...#.#####.....#.#...#.....#...#.....#.#.#...#...#.#.....#.#.....#
#.#.#.#######.#.#.#.#################.#.#.#######.#.#.###.#.#.#.#.#.#.#.#.#####.#####.#####.#.#.#.###.#.###.###.#.#.#.###.###.#.#####.#.#####
#.#.#.....#...#...#.........#.......#...#.........#.#.....#.#.#...#.#.#.#.#.....#####...#...#.#.#...#.#.....#...#.#.#...#.....#.......#.#...#
#.#.#####.#.###############.#.#####.###############.#######.#.#####.#.#.#.#.###########.#.###.#.###.#.#######.###.#.###.###############.#.#.#
#...#.....#.#.....#...#.....#.#.....#.........###...#.....#.#.#...#.#.#.#.#.....###...#...#...#.....#.........#...#.....#...#...#.....#...#.#
#####.#####.#.###.#.#.#.#####.#.#####.#######.###.###.###.#.#.#.#.#.#.#.#.#####.###.#.#####.###################.#########.#.#.#.#.###.#####.#
#.....#...#.#...#...#...#.....#.......#.......#...#...###...#...#.#.#.#.#.#...#.#...#.....#.#...#.....#...#.....#...#.....#...#...###.......#
#.#####.#.#.###.#########.#############.#######.###.#############.#.#.#.#.#.#.#.#.#######.#.#.#.#.###.#.#.#.#####.#.#.#######################
#...#...#...###...........#...........#.....###...#.....#...###...#.#.#.#.#.#...#.......#.#...#...###...#...#.....#...#...#.........#.......#
###.#.#####################.#########.#####.#####.#####.#.#.###.###.#.#.#.#.###########.#.###################.#########.#.#.#######.#.#####.#
#...#.#.....#...#...........#.......#.....#.#.....#.....#.#.#...#...#.#.#.#...#...#.....#.###.........#.......#.........#...#.......#.#.....#
#.###.#.###.#.#.#.###########.#####.#####.#.#.#####.#####.#.#.###.###.#.#.###.#.#.#.#####.###.#######.#.#######.#############.#######.#.#####
#...#.#...#...#...#...........#.....#...#...#.....#.#...#.#.#.#...#...#.#.#...#.#.#.....#...#.......#.#.........#.....#.......###...#.#.#...#
###.#.###.#########.###########.#####.#.#########.#.#.#.#.#.#.#.###.###.#.#.###.#.#####.###.#######.#.###########.###.#.#########.#.#.#.#.#.#
#...#.#...#...#...#.#.........#.....#.#...#...#...#...#.#.#.#.#.###...#.#.#.#...#.#...#...#...#...#.#.#...........###...#.........#...#...#.#
#.###.#.###.#.#.#.#.#.#######.#####.#.###.#.#.#.#######.#.#.#.#.#####.#.#.#.#.###.#.#.###.###.#.#.#.#.#.#################.#################.#
#.....#.....#...#...#.......#.#...#.#.#...#.#.#.......#.#.#.#.#.#...#.#.#.#.#...#.#.#.###.#...#.#.#.#.#.........#...#.....#.................#
###########################.#.#.#.#.#.#.###.#.#######.#.#.#.#.#.#.#.#.#.#.#.###.#.#.#.###.#.###.#.#.#.#########.#.#.#.#####.#################
#...................#.......#...#...#.#...#.#.#...#...#...#...#.#.#...#.#.#.#...#.#.#.#...#...#.#.#.#.....#...#...#...#...#.............#...#
#.#################.#.###############.###.#.#.#.#.#.###########.#.#####.#.#.#.###.#.#.#.#####.#.#.#.#####.#.#.#########.#.#############.#.#.#
#.................#.#.............#...#...#.#.#.#.#.......#.....#.....#.#.#.#.#...#.#...###...#.#.#.....#.#.#.#.....#...#.#.......#.....#.#.#
#################.#.#############.#.###.###.#.#.#.#######.#.#########.#.#.#.#.#.###.#######.###.#.#####.#.#.#.#.###.#.###.#.#####.#.#####.#.#
#.........#...#...#...............#...#.#...#.#.#...#...#.#...#...#...#.#.#.#.#...#.......#.....#.#.....#.#.#.#...#.#...#...#...#...###...#.#
#.#######.#.#.#.#####################.#.#.###.#.###.#.#.#.###.#.#.#.###.#.#.#.###.#######.#######.#.#####.#.#.###.#.###.#####.#.#######.###.#
#.......#...#.#...........#.....#...#.#.#.#...#...#...#.#.#...#.#.#.#...#.#.#...#.#...#...#.......#.....#.#.#.#...#...#.......#.......#...#.#
#######.#####.###########.#.###.#.#.#.#.#.#.#####.#####.#.#.###.#.#.#.###.#.###.#.#.#.#.###.###########.#.#.#.#.#####.###############.###.#.#
#.......#...#.............#.###.#.#.#.#.#.#.#...#...#...#.#.#...#.#.#.....#...#.#...#.#...#.#.....#...#.#.#.#.#.....#.#.....#.........#...#.#
#.#######.#.###############.###.#.#.#.#.#.#.#.#.###.#.###.#.#.###.#.#########.#.#####.###.#.#.###.#.#.#.#.#.#.#####.#.#.###.#.#########.###.#
#.....#...#.................#...#.#.#.#.#.#.#.#.#...#...#.#.#.#...#.......###.#.#.....#...#.#...#.#.#...#.#.#.#.....#.#.#...#.........#...#.#
#####.#.#####################.###.#.#.#.#.#.#.#.#.#####.#.#.#.#.#########.###.#.#.#####.###.###.#.#.#####.#.#.#.#####.#.#.###########.###.#.#
#...#...#.....................#...#.#.#.#.#.#.#.#.....#...#...#.....#...#...#.#.#.....#...#...#.#.#.###...#.#.#...#...#.#.#...........#...#.#
#.#.#####.#####################.###.#.#.#.#.#.#.#####.#############.#.#.###.#.#.#####.###.###.#.#.#.###.###.#.###.#.###.#.#.###########.###.#
#.#...###.....#.....#...#...#...#...#.#.#.#.#.#.....#.#...#...#...#.#.#.....#...#.....#...#...#.#.#...#...#.#.....#.#...#.#.........#...#...#
#.###.#######.#.###.#.#.#.#.#.###.###.#.#.#.#.#####.#.#.#.#.#.#.#.#.#.###########.#####.###.###.#.###.###.#.#######.#.###.#########.#.###.###
#...#.........#...#...#.#.#.#...#.#...#.#.#.#...###.#...#.#.#...#...#...#...#...#...#...#...#...#.#...#...#.......#...#...#...#...#...#...###
###.#############.#####.#.#.###.#.#.###.#.#.###.###.#####.#.###########.#.#.#.#.###.#.###.###.###.#.###.#########.#####.###.#.#.#.#####.#####
#...#.....#.....#.#.....#.#...#.#...###.#.#.#...#...#...#.#.#.....#...#...#...#.#...#...#...#.#...#...#.#...#...#.#.....#...#.#.#.#...#.....#
#.###.###.#.###.#.#.#####.###.#.#######.#.#.#.###.###.#.#.#.#.###.#.#.#########.#.#####.###.#.#.#####.#.#.#.#.#.#.#.#####.###.#.#.#.#.#####.#
#.#...#...#.###...#.....#.###.#...#.....#.#...###...#.#...#.#.#...#.#...#.....#.#.#.....###.#.#.#...#.#.#.#.#.#.#.#.#...#...#...#.#.#.......#
#.#.###.###.###########.#.###.###.#.#####.#########.#.#####.#.#.###.###.#.###.#.#.#.#######.#.#.#.#.#.#.#.#.#.#.#.#.#.#.###.#####.#.#########
#.#...#...#.#...........#.#...#...#...#...###.......#.#...#...#...#...#.#.#...#.#.#...#...#...#.#.#.#.#.#.#...#...#...#.#...###...#...###...#
#.###.###.#.#.###########.#.###.#####.#.#####.#######.#.#.#######.###.#.#.#.###.#.###.#.#.#####.#.#.#.#.#.#############.#.#####.#####.###.#.#
#.#...###...#...........#.#...#.###...#.....#...#...#...#...#...#.#...#.#.#.#...#...#...#.#.....#.#.#.#.#.........#.....#...#...#...#.....#.#
#.#.###################.#.###.#.###.#######.###.#.#.#######.#.#.#.#.###.#.#.#.#####.#####.#.#####.#.#.#.#########.#.#######.#.###.#.#######.#
#.#.#.....#.............#.#...#...#.#...#...###...#...#...#...#.#.#.#...#.#.#.#...#.#.....#.#...#.#.#.#.#.....#...#.....#...#.#...#.#.....#.#
#.#.#.###.#.#############.#.#####.#.#.#.#.###########.#.#.#####.#.#.#.###.#.#.#.#.#.#.#####.#.#.#.#.#.#.#.###.#.#######.#.###.#.###.#.###.#.#
#.#.#...#...#...........#.#...#...#.#.#.#.###.........#.#.#...#.#...#...#.#.#.#.#...#.....#.#.#...#.#.#.#...#.#.#...#...#...#.#.###.#...#.#.#
#.#.###.#####.#########.#.###.#.###.#.#.#.###.#########.#.#.#.#.#######.#.#.#.#.#########.#.#.#####.#.#.###.#.#.#.#.#.#####.#.#.###.###.#.#.#
#...###.......#...#.....#...#.#...#.#.#.#...#.......#...#.#.#.#.....###...#.#.#.......#...#.#...###...#.#...#...#.#...#.....#...#...#...#.#.#
###############.#.#.#######.#.###.#.#.#.###.#######.#.###.#.#.#####.#######.#.#######.#.###.###.#######.#.#######.#####.#########.###.###.#.#
#...............#...#.....#.#...#.#.#.#.#...#.......#.#...#.#.#...#.......#.#.#.......#...#.#...#.......#.......#...#...#.........#...#...#.#
#.###################.###.#.###.#.#.#.#.#.###.#######.#.###.#.#.#.#######.#.#.#.#########.#.#.###.#############.###.#.###.#########.###.###.#
#.....................###...###...#...#...###.........#.....#...#.........#...#...........#...###...............###...###...........###.....#
#############################################################################################################################################";

    assert_eq!(1384, minimum_path(&100, &parse_map(&source)));
}
